<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

    <script>

        const openRequest = indexedDB.open('test', 2);

        openRequest.onupgradeneeded = function() {
            const db = openRequest.result;
            !db.objectStoreNames.contains('tables') && db.createObjectStore('tables', {keyPath: 'id'});
            !db.objectStoreNames.contains('books') && db.createObjectStore('books', {keyPath: 'id'});
        };

        openRequest.onsuccess = () => {

            const db = openRequest.result;

            let transaction = db.transaction('books', 'readwrite');

            let books = transaction.objectStore("books"); // (2)

            const add = new Array(1000).fill().map((_, i) => ({
                id: i,
                price: Math.round (1000 * Math.random() * 100) / 100 + '$',
                title: Math.random().toString(36)
            }))

            let start = Date.now();
            //
            books.add({
                id: 1000,
                data: add
            });

            // for (let i = 0; i < add.length; i++) {
            //     books.add(add[i]);
            // }

            // let request = books.getAll();

            transaction.oncomplete = function() { // (4)
                console.log(Date.now() - start)
            };



            //
            // let book = {
            //     id: 'js2',
            //     price2: 10,
            //     created: new Date()
            // };
            //
            // let request = books.add(book); // (3)
            //
            // request.onsuccess = function() { // (4)
            //     console.log("Книга добавлена в хранилище", request.result);
            // };
            //
            // request.onerror = function() {
            //     console.log("Ошибка", request.error);
            // };
        }

    </script>

</body>
</html>
